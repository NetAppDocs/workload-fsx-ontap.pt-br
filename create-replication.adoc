---
sidebar: sidebar 
permalink: create-replication.html 
keywords: replication, replicate, data protection, disaster recovery, data loss 
summary: Crie uma relação de replicação para um sistema de arquivos FSX for ONTAP para evitar a perda de dados em caso de um desastre inesperado. 
---
= Replicar dados para FSx para ONTAP no NetApp Workload Factory
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
Crie uma relação de replicação para um sistema de arquivos FSx for ONTAP no NetApp Workload Factory para evitar perda de dados em caso de desastre imprevisto. Você pode replicar dados entre dois sistemas de arquivos FSx for ONTAP ou entre um sistema ONTAP on-premises e um sistema de arquivos FSx for ONTAP.

Para a migração de storage VM, você deve concluir a operação de transição imediatamente após criar uma relação de replicação.



== Sobre esta tarefa

A replicação protege seus dados caso um desastre afete sua região; ela também pode ser usada para fins de migração.

Os volumes replicados no sistema de arquivos de destino são volumes de proteção de dados (DP) e seguem o formato de nomenclatura: `{OriginalVolumeName}_copy`.

Se você replicar um volume de origem com arquivos imutáveis, o volume de destino e o sistema de arquivos permanecerão bloqueados até o término do período de retenção do volume de origem. O recurso de arquivos imutáveis está disponível quando você link:create-volume.html["criar um volume"] para um sistema de arquivos FSx for ONTAP.

[NOTE]
====
* A replicação não é suportada para volumes em bloco que utilizam os protocolos iSCSI ou NVMe.
* É possível replicar um volume de origem (leitura/gravação) ou um volume de proteção de dados (DP). A replicação em cascata é compatível, mas um terceiro salto não é. Saiba mais link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html["replicação em cascata"^]sobre o .


====


=== Casos de uso de migração

Ao selecionar o caso de uso de migração, você pode optar por replicar os dados e as configurações da VM de armazenamento para uma única VM de armazenamento. Ao migrar dados e configurações simultaneamente, certifique-se de que a última replicação do volume foi concluída nas últimas 24 horas. Todos os volumes na mesma VM de armazenamento devem ser selecionados para usar esse recurso. A política de camadas para todos os volumes é definida por padrão como a política de camadas do volume de origem, o que é recomendado para caso de uso de migração.

Workload Factory suporta a replicação de migração entre os seguintes sistemas de storage.

* Sistemas ONTAP locais e sistemas de arquivos FSx para ONTAP
* Cloud Volumes ONTAP e FSx para sistemas de arquivos ONTAP
* FSx para ONTAP e FSx para ONTAP sistemas de arquivos
+
** Primeiro para a primeira geração
** Primeira para segunda geração
** Segundo para segunda geração




Para migrar os dados e as configurações da máquina virtual de armazenamento, você deve concluir duas operações.

. <<Crie uma relação de replicação,Crie uma relação de replicação>>, selecione *Migração* como caso de uso e selecione *Replicar configuração da VM de armazenamento*.
. <<Cut over replication,replicação de transferência>> para migrar permanentemente dados e configurações do sistema de arquivos de origem para o sistema de arquivos FSx for ONTAP de destino.




== Crie uma relação de replicação

Replicar dados entre dois sistemas de arquivos FSx for ONTAP ou entre um sistema ONTAP local e um sistema de arquivos FSx for ONTAP.

.Antes de começar
Revise estes requisitos antes de começar.

* Você deve ter um sistema de arquivos FSx for ONTAP para usar como destino na relação de replicação.
* O sistema de arquivos FSx for ONTAP que você usa para a relação de replicação deve ter um link associado. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["Aprenda como associar um link existente ou criar e associar um novo link"]. Depois de associar o link, retorne a esta operação.
* Para replicação de um sistema ONTAP local para um sistema de arquivos FSx for ONTAP, certifique-se de ter descoberto o sistema ONTAP local.
* A replicação não é suportada para volumes em um estado diferente de disponível, criado ou com configuração incorreta, e quando a versão do ONTAP não é compatível.
* Para casos de uso de migração, certifique-se de que a última replicação do volume tenha sido concluída nas últimas 24 horas antes de criar uma relação de replicação com os dados e as configurações da storage VM.


.Passos
. Inicie sessão utilizando uma das link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["experiências de console"^].
. Selecione o menu image:workloads-menu-icon.png["O ícone do menu hambúrguer é usado para navegar até cargas de trabalho como armazenamento, EDA, IA, bancos de dados, VMware e administração."] Em seguida, selecione *Armazenamento*.
. No menu Armazenamento, selecione *FSx para ONTAP*.
. Em *FSx for ONTAP*, selecione o sistema de arquivos que contém o(s) volume(s) a serem replicados.
. Replique todos os volumes em um sistema de arquivos ou replique volumes selecionados.
+
** Para replicar todos os volumes em um sistema de arquivos: Na visão geral do sistema de arquivos, selecione *replique dados*.
** Para replicar volumes selecionados: Na visão geral do sistema de arquivos, selecione a guia *volumes*.
+
Na tabela volumes, selecione um ou mais volumes e, em seguida, selecione *replique dados*.



. Na página replicar dados, em destino replicação, forneça o seguinte:
+
.. *Caso de uso*: Selecione um dos seguintes casos de uso para a replicação.  Dependendo do caso de uso selecionado, o Workload Factory preenche o formulário com valores recomendados de acordo com as melhores práticas.  Você pode aceitar os valores recomendados ou fazer alterações à medida que preenche o formulário.
+
*** Migração: Transfere seus dados para o sistema de arquivos FSX for ONTAP de destino
+
*Replicar configuração da VM de armazenamento*: Opcionalmente, selecione para replicar os dados e as configurações de uma única VM de armazenamento. Ao migrar dados e configurações simultaneamente, certifique-se de que a última replicação do volume foi concluída nas últimas 24 horas. Todos os volumes na mesma VM de armazenamento devem ser selecionados para usar esse recurso. A política de camadas para todos os volumes é definida por padrão como a política de camadas do volume de origem, o que é recomendado para caso de uso de migração.

*** Recuperação de desastres quentes: Garante alta disponibilidade e recuperação rápida de desastres para cargas de trabalho críticas
*** Recuperação de desastres fria ou arquivada:
+
**** Recuperação de desastres inativos: Usa objetivos de tempo de recuperação (rto) mais longos e objetos de ponto de recuperação (RPO) para reduzir custos
**** Arquivamento: Replica dados para storage e conformidade de longo prazo


*** Outros
+
Além disso, a seleção de caso de uso determina a política de replicação ou a política de SnapMirror (ONTAP). Os termos usados para descrever políticas de replicação vêm link:https://docs.netapp.com/us-en/ontap/data-protection/default-protection-policies-concept.html["Documentação do ONTAP 9"^]do .

+
**** Para migração e outros, a política de replicação é chamada _MirrorAllSnapshots_. _MirrorAllSnapshots_ é uma política assíncrona para espelhar todos os snapshots e o sistema de arquivos ativo mais recente.
**** Para recuperação de desastres de arquivos, inativos ou quentes, a política de replicação é chamada _MirrorAndVault_. _MirrorAndVault_ é uma política assíncrona e de cofre para espelhar o mais recente sistema de arquivos ativo e instantâneos diários e semanais.
+
Para todos os casos de uso, se você habilitar snapshots para retenção de longo prazo, a política de replicação padrão é _MirrorAndVault_.





.. *FSX para sistema de arquivos ONTAP*: Selecione credenciais, região e nome do sistema de arquivos FSX for ONTAP para o sistema de arquivos FSX for ONTAP de destino.
.. *Nome da VM de armazenamento*: Selecione a VM de armazenamento no menu suspenso. A VM de armazenamento selecionada é o destino para todos os volumes selecionados neste relacionamento de replicação.
.. *Nome do volume*: O nome do volume de destino é gerado automaticamente com o seguinte `{OriginalVolumeName}_copy` formato . Pode utilizar o nome do volume gerado automaticamente ou introduzir outro nome de volume.
.. *Política de disposição em categorias*: Selecione a política de disposição em categorias para os dados armazenados no volume de destino. A política de disposição em categorias padrão é a política de disposição em categorias recomendada para o caso de uso selecionado.
+
_Balanceado (Automático)_ é a política de camadas padrão ao criar um volume usando o console do Workload Factory.  Para obter mais informações sobre políticas de níveis de volume, consultelink:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/volume-storage-capacity.html#data-tiering-policy["Capacidade de armazenamento de volume"^] na documentação do AWS FSx para NetApp ONTAP .  Observe que o Workload Factory usa nomes baseados em casos de uso no console do Workload Factory para políticas de camadas e inclui nomes de políticas de camadas do FSx para ONTAP entre parênteses.

+
Se você selecionou o caso de uso de migração, o Workload Factory seleciona automaticamente copiar a política de camadas do volume de origem para o volume de destino.  Você pode desmarcar a opção de copiar a política de camadas e selecionar uma política de camadas que se aplique ao volume selecionado para replicação.

.. *Taxa máxima de transferência*: Selecione *limitada* e insira o limite máximo de transferência em MB/s. Em alternativa, selecione *Unlimited*.
+
Sem um limite, o desempenho da rede e do aplicativo pode declinar. Como alternativa, recomendamos uma taxa de transferência ilimitada para os sistemas de arquivos FSX for ONTAP para cargas de trabalho críticas, por exemplo, aquelas que são usadas principalmente para recuperação de desastres.



. Em Configurações de replicação, forneça o seguinte:
+
.. *Intervalo de replicação*: Selecione a frequência em que os instantâneos são transferidos do volume de origem para o volume de destino.
.. *Retenção de longo prazo*: Opcionalmente, habilite snapshots para retenção de longo prazo. A retenção de longo prazo permite que os serviços empresariais continuem operando mesmo em caso de falha completa do local, dando suporte ao failover de aplicações de forma transparente, usando uma cópia secundária.
+
Replicações sem retenção de longo prazo usam a política _MirrorAllSnapshots_. Habilitar a retenção de longo prazo atribui a política _MirrorAndVault_ à replicação.

+
Se você habilitar a retenção a longo prazo, selecione uma política existente ou crie uma nova política para definir os snapshots a serem replicados e o número a ser retido.

+

NOTE: Rótulos de origem e destino correspondentes são necessários para retenção a longo prazo. Se desejar, a fábrica Workload pode criar rótulos ausentes para você.

+
*** *Escolha uma política existente*: Selecione uma política existente no menu suspenso.
*** *Criar uma nova política*: insira um *nome de política*.


.. *Snapshots imutáveis*: Opcional. Selecione *Ativar instantâneos imutáveis* para evitar que os instantâneos obtidos nesta política sejam excluídos durante o período de retenção.
+
*** Defina o *período de retenção* em número de horas, dias, meses ou anos.
*** *Políticas de snapshot*: Na tabela, selecione a frequência da política de snapshot e o número de cópias a reter. Pode selecionar mais de uma política de instantâneos.


.. *Ponto de acesso S3*: Opcionalmente, conecte um ponto de acesso S3 para acessar dados do sistema de arquivos FSx for ONTAP residentes em volumes NFS ou SMB/CIFS por meio das APIs do AWS S3. Somente o tipo de acesso a arquivos é suportado. Fornecendo os seguintes detalhes:
+
*** *Nome do ponto de acesso S3*: Insira o nome do ponto de acesso S3.
*** *Usuário*: Selecione um usuário existente com acesso ao volume ou crie um novo usuário.
*** *Tipo de usuário*: Selecione *UNIX* ou *Windows* como o tipo de usuário.
*** *Configuração de rede*: Selecione *Internet* ou *nuvem privada virtual (VPC)*. O tipo de rede que você escolher determina se o ponto de acesso é acessível pela internet ou restrito a uma VPC específica.
*** *Habilitar metadados*: Habilitar metadados cria uma tabela S3 contendo todos os objetos acessíveis pelo ponto de acesso S3, que você pode usar para auditoria, governança, automação, análise e otimização. Habilitar metadados acarreta custos adicionais da AWS. Consulte link:https://aws.amazon.com/s3/pricing/["Documentação de preços do Amazon S3"^] para mais informações.


.. *Etiquetas de ponto de acesso S3*: opcionalmente, você pode adicionar até 50 etiquetas.




. Selecione *criar*.


.Resultado
A relação de replicação aparece na guia *relacionamentos de replicação* no sistema de arquivos FSX for ONTAP de destino.

Se você criou uma relação de replicação para fins de migração, é necessário transferir todos os volumes e suas respectivas VMs de armazenamento para concluir a migração dos dados e configurações das VMs de armazenamento para o sistema de arquivos FSx for ONTAP de destino.



== Corte da replicação para casos de uso de migração

Após criar uma relação de replicação para um caso de uso de migração, você deve realizar a transição da replicação para concluir a migração dos dados e das configurações da VM de armazenamento para o sistema de arquivos FSx for ONTAP de destino. A transição da replicação migra permanentemente os dados e as configurações da VM de armazenamento do sistema de arquivos de origem para o sistema de arquivos FSx for ONTAP de destino. Durante a transição, os dados são replicados pela última vez. O sistema exclui o(s) volume(s) de origem após a conclusão da transição. Você não pode desfazer essa ação.

.Antes de começar
Revise estes requisitos antes de começar.

* Interrompa qualquer acesso de cliente à sua máquina virtual de armazenamento antes de alternar a replicação.
* Certifique-se de que todos os volumes de origem não estejam servindo nenhum dado antes de alternar a replicação.
* Certifique-se de que os dados estejam sincronizados entre os volumes de origem e destino antes de alternar a replicação.
* O sistema de arquivos FSx for ONTAP que você usa para a relação de replicação deve ter um link associado. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["Aprenda como associar um link existente ou criar e associar um novo link"]. Depois de associar o link, retorne a esta operação.


.Passos
. Inicie sessão utilizando uma das link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["experiências de console"^].
. Selecione o menu image:workloads-menu-icon.png["O ícone do menu hambúrguer é usado para navegar até cargas de trabalho como armazenamento, EDA, IA, bancos de dados, VMware e administração."] Em seguida, selecione *Armazenamento*.
. No menu Armazenamento, selecione *FSx para ONTAP*.
. Em *FSx for ONTAP*, selecione o sistema de arquivos que contém o(s) volume(s) a serem replicados.
. Selecione a guia *Replication relationships*.
. Na tabela de relações de replicação, selecione a relação de replicação para migrar e, em seguida, selecione *Migrar replicação*.
. Analise as informações na caixa de diálogo Cut over replication e digite _cut over_ para confirmar.


. Selecione *Cut over*.


.Resultado
Após a migração, os volumes de origem são excluídos e os volumes de destino tornam-se leitura/gravação. Você pode link:change-tiering-policy.html["modificar a política de hierarquização"] para os volumes de destino após a migração.
